<!DOCTYPE html>
<html>
  <head>
    <title>Python Websockets Chat Demo</title>
    <link href="{{ b.css_url }}" rel="stylesheet" media="screen">
    <!----<link href="static/css/application.css" rel="stylesheet" media="screen">--->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js" integrity="sha384-DkkWv9oJFWLIydBXXjkBWnG1/fuVhw8YPBq37uvvD6WSYRFRqr21eY5Dg9ZhmWdy" crossorigin="anonymous"></script>



  </head>
  <body>
    <div class="container">
      <div class="jumbotron">
        <h1>Python Websockets Chat Demo</h1>
        <hr />
        <p>Chat proof of concept for +{{ b.name }}</p>
      </div>
        <div class="form-group">
          <input id="guildname" type="hidden" value="{{ b.name }}">
          <input id="input-text" type="text" class="form-control" placeholder="Enter chat text here!" autofocus />
        </div>
        <button id="chatsend" class="btn btn-primary" type="submit">Send</button>
      <div class="page-header">
        <h1>Chat Log</h1>
      </div>
      <div id="chat-text">
      </div>
    </div>

    <script type="text/javascript" src="/assets/js/jquery-2.0.3.min.js"></script>

    <script>
      var socket=io();

    $('#chatsend').click(function (event) {

      if (event.which != 1) {
        return
      }
      event.preventDefault();

      console.log('clicked')

      text = $('#input-text').val()

      socket.emit('speak', {data: text});
      $('#input-text').val('')

    });

    socket.on('speak', function(json){
      console.log(json);
      username=json['username'];
      text=json['text'];
      $('#chat-text').append('<p><b>@'+username+'</b> '+text+'</p>')
      }
    );

    socket.on('message', function(msg){$('#chat-text').append('<p>'+msg+'</p>')});

    socket.on('connect',
        function(event) {
          console.log('connected, joining room')
          name=$('#guildname').val();
          socket.emit('join room', {'guild': name });
        }
      )

    
    </script>
  </body>
</html>